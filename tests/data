---
controls:
id: 1
description: "Master Checks"
type: "master"
groups:
- id: 1.1
  description: "Kube-apiserver"
  checks:
    - id: 0
      description: "0: flag is set"
      tests:
        test_items:
          - flag: "--allow-privileged"
            set: true

    - id: 1
      description: "1: flag is not set"
      tests:
        test_items:
          - flag: "--basic-auth"
            set: false

    - id: 2
      description: "2: flag value is set to some value"
      tests:
        test_items:
          - flag: "--insecure-port"
            compare:
              op: eq
              value: 0
            set: true

    - id: 3
      description: "3: flag value is greater than or equal some number"
      tests:
        test_items:
          - flag: "--audit-log-maxage"
            compare:
              op: gte
              value: 30
            set: true

    - id: 4
      description: "4: flag value is less than some number"
      tests:
        test_items:
          - flag: "--max-backlog"
            compare:
              op: lt
              value: 30
            set: true

    - id: 5
      description: "5: flag value does not have some value"
      tests:
        test_items:
          - flag: "--admission-control"
            compare:
              op: nothave
              value: AlwaysAdmit
            set: true

    - id: 6
      description: "6: test AND binary operation"
      tests:
        bin_op: and
        test_items:
        - flag: "--kubelet-client-certificate"
          set: true
        - flag: "--kubelet-clientkey"
          set: true

    - id: 7
      description: "7: test OR binary operation"
      tests:
        bin_op: or
        test_items:
          - flag:  "--secure-port"
            compare:
              op: eq
              value: 0
            set: true
          - flag: "--secure-port"
            set: false

    - id: 8
      description: "8: test flag with arbitrary text"
      tests:
        test_items:
        - flag: "644"
          compare:
            op: has
            value: "644"
          set: true

    - id: 9
      description: "9: test flag with multiple arbitrary text"
      audit: "/bin/sh -c 'if test -e $config; then stat -c %a $config; fi'"
      tests:
        bin_op: or
        test_items:
        - flag: "644"
          compare:
            op: eq
            value: "644"
        - flag: "640"
          compare:
            op: eq
            value: "640"
        - flag: "600"
          compare:
            op: eq
            value: "600"

    - id: 10
      description: "10: flag value includes some value in a comma-separated list, value is last in list"
      tests:
        test_items:
          - flag: "--admission-control"
            compare:
              op: has
              value: RBAC
            set: true

    - id: 11
      description: "11: flag value includes some value in a comma-separated list, value is first in list"
      tests:
        test_items:
          - flag: "--admission-control"
            compare:
              op: has
              value: WebHook
            set: true

    - id: 12
      description: "12: flag value includes some value in a comma-separated list, value middle of list"
      tests:
        test_items:
          - flag: "--admission-control"
            compare:
              op: has
              value: Something
            set: true

    - id: 13
      description: "13: flag value includes some value in a comma-separated list, value only one in list"
      tests:
        test_items:
          - flag: "--admission-control"
            compare:
              op: has
              value: Something
            set: true

    - id: 14
      description: "14: long flag, short string; flag should not match"
      tests:
        test_items:
          - flag: "--admission-control-config"
            compare:
              op: has
              value: Something
            set: true

    - id: 15
      description: "15: short flag, long string; flag should not match"
      tests:
        test_items:
          - flag: "--admission-control"
            compare:
              op: has
              value: Something
            set: true
